{% extends 'base.html' %} {% load static %} {% block content %}
<div class="content-wrapper">
    <div class="row">
        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-9">
                            <div class="d-flex align-items-center align-self-start">
                                <h3 class="mb-0">{{ daily_avg }}</h3>
                                <p class="text-success ml-2 mb-0 font-weight-medium">CM</p>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="icon icon-box-success ">
                                <span class="mdi mdi-arrow-top-right icon-item"></span>
                            </div>
                        </div>
                    </div>
                    <h6 class="text-strong font-weight-bold text-uppercase mt-5">Rain fall Average
                        (Daily)</h6>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-9">
                            <div class="d-flex align-items-center align-self-start">
                                <h3 class="mb-0">{{ weekly_avg }}</h3>
                                <p class="text-success ml-2 mb-0 font-weight-medium">CM</p>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="icon icon-box-success">
                                <span class="mdi mdi-arrow-top-right icon-item"></span>
                            </div>
                        </div>
                    </div>
                    <h6 class="text-strong font-weight-bold text-uppercase mt-5">Rain fall Average
                        (Weekly)</h6>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-9">
                            <div class="d-flex align-items-center align-self-start">
                                <h3 class="mb-0">{{ current_rainfall }}</h3>
                                <p class="text-success ml-2 mb-0 font-weight-medium">CM</p>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="icon icon-box-success">
                                <span class="mdi mdi-arrow-top-right icon-item"></span>
                            </div>
                        </div>
                        <div class="col mt-3 mb-3">
                            <div class="progress progress-sm mr-2">
                                <div class="progress-bar bg-info" role="progressbar"
                                    style="width: {{ current_rainfall }}%" aria-valuenow="50" aria-valuemin="0"
                                    aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>

                    <h6 class="text-strong font-weight-bold text-uppercase">Current Rain fall</h6>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-9">
                            <div class="d-flex align-items-center align-self-start">
                                <h3 class="mb-0">{{ next_state|title }}</h3>
                            </div>
                        </div>
                        <div class="col-3">
                            {% if next_state == 'drought' %}
                            <div class="icon icon-box-danger ">
                                <span class="mdi mdi-arrow-bottom-left icon-item"></span>
                            </div>
                            {% elif next_state == 'almost_drought' %}
                            <div class="icon icon-box-warning ">
                                <span class="mdi mdi-arrow-top-right icon-item"></span>
                            </div>
                            {% else %}
                            <div class="icon icon-box-primary ">
                                <span class="mdi mdi-arrow-top-right icon-item"></span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="col mb-3 mt-3">
                            <div class="progress progress-sm mr-2">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 90%"
                                    aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                    {% if next_state == 'drought' %}
                    <h6 class="text-strong text-danger font-weight-bold text-uppercase">Next Hour State</h6>
                    {% elif next_state == 'almost_drought' %}
                    <h6 class="text-strong text-warning font-weight-bold text-uppercase">Next Hour State</h6>
                    {% else %}
                    <h6 class="text-strong text-primary font-weight-bold text-uppercase">Next Hour State</h6>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row">

        <!-- Area Chart -->
        <div class="col-xl-12 col-lg-12">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Rain fall</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-area">
                        <canvas id="myAreaChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="row">

        <!-- Area Chart -->
        <div class="col-xl-12 col-lg-12">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Drought State</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-area2">
                        <canvas id="myAreaChart2"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

{% endblock %} {% block javascript %} {{ block.super }}
<script>
    var data = {{ measured_rainfall | safe}}
    var predictedDroughtState = {{ predictions | safe}}
    var measuredDroughtState = {{ measured_drought_state | safe }}

    console.log('predicted', data);
    var time_type = "{{ time_type }}"
</script>

<!-- Page level plugins -->
<!-- <script src="{% static 'vendor/chart.js/Chart.min.js' %}"></script> -->

<!-- Page level custom scripts -->
<script src="{% static 'js/demo/chart-area-demo.js' %}"></script>
<script src="{% static 'js/demo/chart-pie-demo.js' %}"></script>
<script>
    var chatSocket = new WebSocket('ws://' + window.location.host + '/data/');

    chatSocket.onmessage = function (e) {
        console.log(e);
        const _data = JSON.parse(e.data);
        if (_data['prediction_update']) {
            window.location.reload()
        }
        const _rain = _data['rainfall'];
        const _state = _data['rainfall'];
        addData(myLineChart, _rain)
        addData(myLineChart2, _state)
    };

    chatSocket.onclose = function (e) {
        console.error('Chat socket closed unexpectedly');
    };
</script>

{% endblock %}